<!DOCTYPE html>
<html class="no-js" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../readout/" rel="prev"/>
<link href="../dac/" rel="next"/>
<link href="../../ADL_Logo.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.20" name="generator"/>
<title>SPI Interface - AstroPix Documentation</title>
<link href="../../assets/stylesheets/main.e53b48f4.min.css" rel="stylesheet"/>

<link href="../../assets/external/fonts.googleapis.com/css.49ea35f2.css" rel="stylesheet">
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../assets/external/unpkg.com/katex@0/dist/katex.min.css" rel="stylesheet">
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#daq-to-fe">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="AstroPix Documentation" class="md-header__button md-logo" data-md-component="logo" href="../.." title="AstroPix Documentation">
<img alt="logo" src="../../ADL_Logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            AstroPix Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              SPI Interface
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="AstroPix Documentation" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="AstroPix Documentation">
<img alt="logo" src="../../ADL_Logo.png"/>
</a>
    AstroPix Documentation
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            Overview
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    AstroPix3 User Guide
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            AstroPix3 User Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../pixelelectronics/">
<span class="md-ellipsis">
    Pixel Electronics
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../readout/">
<span class="md-ellipsis">
    Matrix Readout
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    SPI Interface
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    SPI Interface
    
  </span>
</a>
<nav aria-label="Table of Contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of Contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#daq-to-fe">
<span class="md-ellipsis">
      DAQ to FE
    </span>
</a>
<nav aria-label="DAQ to FE" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#commands">
<span class="md-ellipsis">
      Commands
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#shift-register-io-and-spi-command">
<span class="md-ellipsis">
      Shift Register I/O and SPI Command
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../dac/">
<span class="md-ellipsis">
    DAC
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../configuration/">
<span class="md-ellipsis">
    Configuration Registers
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../pins/">
<span class="md-ellipsis">
    Pins
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../astropix4/">
<span class="md-ellipsis">
    AstroPix4 User Guide
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            AstroPix4 User Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../astropix5/">
<span class="md-ellipsis">
    AstroPix5 User Guide
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            AstroPix5 User Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="spi-daisychain-interface">SPI Daisychain Interface<a class="headerlink" href="#spi-daisychain-interface" title="Permanent link">¶</a></h1>
<h2 id="daq-to-fe">DAQ to FE<a class="headerlink" href="#daq-to-fe" title="Permanent link">¶</a></h2>
<p>AstroPix accepts commands via MOSI in the following 8 bit format:</p>
<figure>
<script class="wavedrom" type="WaveDrom">
    {
        reg:[
            {bits: 5,  name: 'Chip Address (5b)', type: 4},
            {bits: 3,  name: 'Command (3b)', type: 3},
        ], config:{bits: 8}
    }
    </script>
<figcaption>
<p>SPI command format</p>
</figcaption>
</figure>
<p>All valid commands are listed in the table below:</p>
<table>
<thead>
<tr>
<th>BIT</th>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>[4:0]</td>
<td>Address</td>
<td>0x00 -  0x14 : Single addresses<br/>0x15 - 0x1F : Reserved<br/>0x1D: Invalid<br/>0x1E: Broadcast</td>
</tr>
<tr>
<td>[7:5]</td>
<td>Command</td>
<td>0x01 - NOCMD / IDLE<br/>0x02 - Routing: dispatch<br/>0x03 - Shift Register Config addresses</td>
</tr>
</tbody>
</table>
<p>The IDLE Byte represents no specific command and an invalid address: 0x1D for address and 0x1 for IDLE -&gt; 0x3D</p>
<figure>
<script class="wavedrom" type="WaveDrom">
    {
        reg:[
            {bits: 5,  name: '0x1D', type: 4, attr: "Address"},
            {bits: 3,  name: '0x1', type: 3, attr: "Command"},
        ], config:{bits: 8}
    }
    </script>
<figcaption>
<p>SPI IDLE command</p>
</figcaption>
</figure>
<h3 id="commands">Commands<a class="headerlink" href="#commands" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>COMMAND</th>
<th>NAME</th>
<th>LENGTH</th>
<th>DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x01</td>
<td>NOCMD</td>
<td>1 Byte</td>
<td>Nothing to do</td>
</tr>
<tr>
<td>0x02</td>
<td>Address Config</td>
<td>1 Byte</td>
<td>Header Address represents the new address of the Chip. Chip forwards command to the next chip with Address = Address + 1<br/>To configure Addresses with first Chip “00”, send 0x40 to the first Chip, then send some IDLE bytes so that the Clock stays active and the addressing byte gets passed down the chain</td>
</tr>
<tr>
<td>0x03</td>
<td>Shift Register Config</td>
<td>N Bytes</td>
<td>Once this command is send, the whole SPI Frame is used - SPI Chip Select must be deasserted and reasserted to send a new command</td>
</tr>
</tbody>
</table>
<h3 id="shift-register-io-and-spi-command">Shift Register I/O and SPI Command<a class="headerlink" href="#shift-register-io-and-spi-command" title="Permanent link">¶</a></h3>
<p>The Shift Register I/O exposes two clocks, a serial input (SIN), and a load signal to load the bits to the registers.
Each bit present on the SIN serial line is clocked through the shift register after Clock 1 and Clock have been toggled separately. The following diagram shows the simple sequence:</p>
<script class="wavedrom" type="WaveDrom">
    { signal : [
        {name: 'Ck1',    wave: '0.10..10..10...'},
        {name: 'Ck2',     wave: '0...10..10..10.'},
        {name: 'SIN',     wave: 'x5..x5..x5..x..', data: ['Bit 0','Bit 1', 'Bit 2']},
        {name: 'Load',   wave: '0............10'},
    ]
}
    </script>
<p>The SPI Command generates this sequence by using in each byte one bit as Serial In, and the other bits as clock time to generate the CLK1/CLK2 and Load sequence:</p>
<ul>
<li>First Byte is 0x3 command and target Chip (or broadcast ID)</li>
<li>Each following byte shifts a 0 or 1 in the Shift Register. The LSB of the byte is used for Serial in (8’bxxxxxxx1 or 8’bxxxxxxx0)</li>
<li>At the end of the sequence, send a byte with bit[1] = 1 to generate the Load signal</li>
<li>When the frame finishes, the Load signal goes back to 0.</li>
</ul>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Nicolas Striebig 2025
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.sections", "navigation.indexes", "navigation.top", "content.code.copy", "toc.integrate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
<script src="../../assets/external/unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
<script src="../../javascripts/tablesort.js"></script>
<script src="../../javascripts/wavedrom.js"></script>
<script src="../../assets/external/cdnjs.cloudflare.com/ajax/libs/wavedrom/3.1.0/skins/default.js"></script>
<script src="../../assets/external/cdnjs.cloudflare.com/ajax/libs/wavedrom/3.1.0/wavedrom.min.js"></script>
<script src="../../javascripts/katex.js"></script>
<script src="../../assets/external/unpkg.com/katex@0/dist/katex.min.js"></script>
<script src="../../assets/external/unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
<script src="../../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
<script id="init-glightbox">document.querySelectorAll('.glightbox').forEach(function(element) {
    try {
        var img = element.querySelector('img');
        if (img && img.src) {
            element.setAttribute('href', img.src);
        } else {
            console.log('No img element with src attribute found');
        }
    } catch (error) {
        console.log('Error:', error);
    }
});
const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script><script>window.addEventListener('load', function() {wavedrom.processAll();});</script></body></html>